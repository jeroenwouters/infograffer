var mongo=require("mongodb"),Server=mongo.Server,Db=mongo.Db,BSON=mongo.BSONPure,server=new Server("localhost",27017,{auto_reconnect:!0});db=new Db("itemdb",server);db.open(function(e,t){if(!e){console.log("Connected to 'itemdb' database");t.collection("items",{safe:!0},function(e,t){if(e){console.log("The 'items' collection doesn't exist. d");populateDB()}})}});exports.findById=function(e,t){var n=e.params.id;console.log("Retrieving item: "+n);db.collection("items",function(e,r){r.findOne({_id:new BSON.ObjectID(n)},function(e,n){t.send(n)})})};exports.findAll=function(e,t){db.collection("items",function(e,n){n.find().toArray(function(e,n){t.send(n)})})};exports.findAllMaps=function(e,t){db.collection("items",function(e,n){n.find().toArray(function(e,n){t.send(n)})})};exports.additem=function(e,t){var n=e.body;console.log("Adding item: "+JSON.stringify(n));db.collection("items",function(e,r){r.insert(n,{safe:!0},function(e,n){if(e)t.send({error:"An error has occurred"});else{console.log("Success: "+JSON.stringify(n[0]));t.send(n[0])}})})};exports.updateitem=function(e,t){var n=e.params.id,r=e.body;console.log("Updating item: "+n);console.log(JSON.stringify(r));db.collection("items",function(e,i){i.update({_id:new BSON.ObjectID(n)},r,{safe:!0},function(e,n){if(e){console.log("Error updating item: "+e);t.send({error:"An error has occurred"})}else{console.log(""+n+" document(s) updated");t.send(r)}})})};exports.deleteitem=function(e,t){var n=e.params.id;console.log("Deleting item: "+n);db.collection("items",function(r,i){i.remove({_id:new BSON.ObjectID(n)},{safe:!0},function(n,r){if(n)t.send({error:"An error has occurred - "+n});else{console.log(""+r+" document(s) deleted");t.send(e.body)}})})};